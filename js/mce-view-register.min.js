!function(a,b,c){var d,e,f,g,h=wp.fee.postOnServer.ID||0;wp.mce.View.prototype.setContent=function(a,b,c){this.getNodes(function(c,d,e){a=a.body||a,-1!==a.indexOf("<iframe")&&(a+='<div class="wpview-overlay"></div>'),e.innerHTML="",e.appendChild(_.isString(a)?c.dom.createFragment(a):a),b&&b.apply(this,arguments)},c)},_.each(["gallery","audio","video","playlist","embed","embedURL"],b.unregister),d={state:[],edit:function(a,b){var c=wp.media[this.type],d=c.edit(a);_.each(this.state,function(a){d.state(a).on("update",function(a){b(c.shortcode(a).string())})}),d.on("close",function(){d.detach()}),d.open()}},e=_.extend({},d,{state:["gallery-edit"],initialize:function(){var a=this;wp.ajax.post("fee_shortcode",{post_ID:h,shortcode:this.text}).done(function(b){a.content=b,a.render()})}}),f=_.extend({},d,{action:"parse-media-shortcode",initialize:function(){var a=this;this.url&&(this.loader=!1,this.shortcode=wp.media.embed.shortcode({url:this.text})),wp.ajax.post(this.action,{post_ID:h,type:this.shortcode.tag,shortcode:this.shortcode.string()}).done(function(b){a.content=b,a.render()}).fail(function(b){a.url?a.removeMarkers():a.setError(b.message||b.statusText,"admin-media")})},bindNode:function(b,d,e){var f=c(e),g=f.find(".wp-audio-shortcode"),h=f.find(".wp-video-shortcode"),i=f.find(".wp-playlist");g.add(h).mediaelementplayer(a._wpmejsSettings),i.length&&new a.WPPlaylistView({el:i.get(0),metadata:c.parseJSON(c(this.content).find("script").html())})},unbindNode:function(b,d,e){var f=c(e).find(".mejs-container");f.length&&a.mejs.players[f.get(0).id].remove()}}),g=_.extend({},f,{action:"parse-embed",edit:function(a,b){var c=wp.media.embed,d=c.edit(a,this.url),e=this,f="change:url change:width change:height";d.state("embed").props.on(f,function(a,b){b&&a.get("url")&&(d.state("embed").metadata=a.toJSON())}),d.state("embed").on("select",function(){var a=d.state("embed").metadata;b(e.url&&!a.width?a.url:c.shortcode(a).string())}),d.on("close",function(){d.detach()}),d.open()}}),b.register("gallery",_.extend({},e)),b.register("audio",_.extend({},f,{state:["audio-details"]})),b.register("video",_.extend({},f,{state:["video-details"]})),b.register("playlist",_.extend({},f,{state:["playlist-edit","video-playlist-edit"]})),b.register("embed",_.extend({},g)),b.register("embedURL",_.extend({},g,{match:function(a){var b=/(^|<p>)(https?:\/\/[^\s"]+?)(<\/p>\s*|$)/gi,c=b.exec(a);return c?{index:c.index+c[1].length,content:c[2],options:{url:!0}}:void 0}}))}(window,window.wp.mce.views,window.jQuery);