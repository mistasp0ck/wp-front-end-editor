!function(a){"use strict";window.wp=window.wp||{},wp.fee={},wp.heartbeat.interval(15),_.extend(wp.fee,window.fee),a(function(){function b(){A=!1,clearTimeout(B),B=setTimeout(function(){A=!0},3e5)}function c(){G&&(a("#wp-admin-bar-edit").addClass("active"),J.removeClass("fee-off").addClass("fee-on"),M.addClass("has-post-thumbnail"),p(function(a){a.show()}),C=i(),wp.autosave&&(wp.autosave.local.resume(),wp.autosave.server.resume()),I.trigger("fee-on"),G=!1)}function d(a){G||"auto-draft"===wp.fee.post.post_status()||(l()?n(function(){e(a)}):e(a))}function e(b){wp.autosave&&(wp.autosave.local.suspend(),wp.autosave.server.suspend()),a("#wp-admin-bar-edit").removeClass("active"),J.removeClass("fee-on").addClass("fee-off"),N.find("img").length||M.removeClass("has-post-thumbnail"),w.html(wp.fee.postOnServer.post_title),v.html(wp.fee.postOnServer.post_title),x&&(document.title=x.replace("<!--replace-->",wp.fee.postOnServer.post_title)),I.trigger("fee-off"),G=!0,b&&(document.location.href=b)}function f(){G?c():d()}function g(){return!G}function h(){return G}function i(){var a={};return _.each(wp.fee.post,function(b,c){a[c]=b()}),a}function j(a,b){var c;I.trigger("fee-before-save"),c=i(),c.publish=b?!0:void 0,c.save=b?void 0:!0,c._wpnonce=wp.fee.nonces.post,S.prop("disabled",!0),cb.start(),wp.ajax.post("fee_post",c).always(function(){S.prop("disabled",!1),cb.stop()}).done(function(b){wp.fee.postOnServer=b.post,U.html(b.processedPostContent),window.wpCookies.set("wp-saving-post-"+wp.fee.postOnServer.ID,"saved"),s&&s.remove(),t&&t.remove(),b.message&&(t=o(b.message,"updated",!0)),m(),C=i(),I.trigger("fee-after-save"),a&&a()}).fail(function(a){a.message&&o(a.message,"error")})}function k(b){j(b,!0),a("#wp-admin-bar-edit-publish").hide(),a("#wp-admin-bar-edit-save > a").text("Update")}function l(){return G?void 0:_.some(arguments.length?arguments:["post_title","post_content"],function(a){return C[a]&&wp.fee.post[a]?wp.fee.post[a]()!==C[a]:void 0})}function m(){G||p(function(a){a.undoManager.add()})}function n(a){W.show(),W.find(".fee-exit").focus().on("click.fee",function(){a(),W.hide()}),W.find(".fee-save-and-exit").on("click.fee",function(){j(a),W.hide()}),W.find(".fee-cancel").on("click.fee",function(){W.hide()})}function o(b,c,d){var e=a("<div>").addClass(c);return e.append("<p>"+b+"</p>"+(d===!0?"":'<div class="dashicons dashicons-dismiss"></div>')),X.prepend(e),e.find(".dashicons-dismiss").on("click.fee",function(){e.remove(),d!==!0&&d()}),d===!0&&e.delay(5e3).fadeOut("slow",function(){e.remove()}),e}function p(a){_.each(Z,a)}function q(a){Z.push(a),a.on("init",function(){$++,$===Z.length&&I.trigger("fee-editor-init")})}function r(){var b,c={};u=a(".fee-title"),v=u.parent(),u.remove(),w=[],!w.length&&v.each(function(b,d){a(d).parents().each(function(b,e){var f=a.inArray(e,Y);return f>-1?(c[f]=c[f]||[],c[f].push(d),!1):void 0})});for(b in c){w=a(c[b]);break}w.length&&(v=v.not(w),x=w.text().length?document.title.replace(w.text(),"<!--replace-->"):document.title,w.addClass("fee-title"),D.init({selector:".fee-title",theme:"fee",paste_as_text:!0,plugins:"paste",inline:!0,placeholder:F.title,entity_encoding:"raw",setup:function(a){y=a,q(a),a.on("setcontent keyup",function(){wp.fee.post.post_title(wp.fee.post.post_title(),!0)}),a.on("keydown",function(a){13===a.keyCode&&(z.focus(),a.preventDefault())})}}))}var s,t,u,v,w,x,y,z,A,B,C,D=window.tinymce,E=D.util.VK,F=window.feeL10n,G=!0,H=a(window),I=a(document),J=a(document.body),K=a(".fee-post"),L=a('a[href="#fee-edit-link"]'),M=a(".has-post-thumbnail"),N=a(".fee-thumbnail"),O=a(".fee-thumbnail-wrap"),P=a(".fee-edit-thumbnail").add(".fee-insert-thumbnail"),Q=a(".fee-remove-thumbnail"),R=a(".fee-toolbar"),S=R.find(".button").add(a(".fee-save-and-exit")),T=a(".fee-content"),U=a(".fee-content-original"),V=a(".fee-categories"),W=a(".fee-leave"),X=a("#fee-notice-area"),Y=T.parents(),Z=[],$=0,ab=!0,bb=0,cb={start:function(){bb||J.addClass("progress"),bb++},stop:function(){bb&&bb--,bb||J.removeClass("progress")}};wp.fee.post={},_.each(wp.fee.postOnServer,function(a,b){wp.fee.post[b]=function(){return wp.fee.postOnServer[b]}}),wp.fee.post.post_ID=function(){return wp.fee.postOnServer.ID||0},wp.fee.post.post_title=function(a,b){return a?(x&&(document.title=x.replace("<!--replace-->",a)),v.each(function(b,c){c.innerHTML=a}),b||(w.get(0).innerHTML=a),this.post_title()):y?y.getContent()||"":wp.fee.postOnServer.post_title},wp.fee.post.post_content=function(a){var b;return a&&"raw"!==a&&"html"!==a?(z.undoManager.add(),z.setContent(a),this.post_content()):(b=z.getContent({format:a||"html"})||"","raw"!==a&&(b=b.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>"),b=window.switchEditors.pre_wpautop(b)),b)},wp.fee.post.post_category=function(){var b=[];return a('input[name="post_category[]"]:checked').each(function(){b.push(a(this).val())}),b},b(),D.init(_.extend(wp.fee.tinymce,{setup:function(a){z=a,window.wpActiveEditor=a.id,q(a),a.on("BeforeSetContent",function(a){a.content&&(a.content=a.content.replace(/<p>(?:&nbsp;|\s)+<\/p>/gi,"<p><br></p>"))})}})),r(),H.on("beforeunload.fee",function(){return!G&&l()?((event||window.event).returnValue=F.saveAlert,F.saveAlert):void 0}).on("unload.fee-remove-lock",function(a){ab&&(a.target&&"#document"!==a.target.nodeName||wp.ajax.post("wp-remove-post-lock",{_wpnonce:wp.fee.nonces.post,post_ID:wp.fee.post.ID(),active_post_lock:wp.fee.lock}))}),I.on("fee-editor-init.fee",function(){(J.hasClass("fee-on")||-1!==document.location.hash.indexOf("edit=true"))&&c(),J.hasClass("fee-off")&&!N.find("img").length&&M.removeClass("has-post-thumbnail"),I.on("autosave-restore-post",function(a,b){wp.fee.post.post_title(b.post_title),wp.fee.post.post_content(b.content)}),C=i(),wp.fee.postOnServer.post_content!==wp.fee.post.post_content()&&window.console.log("The content on the server and the content in the editor is different. This may be due to errors.")}).on("autosave-enable-buttons.fee",function(){S.prop("disabled",!1)}).on("autosave-disable-buttons.fee",function(){wp.heartbeat&&wp.heartbeat.hasConnectionError()||S.prop("disabled",!0)}).on("keydown.fee",function(a){83===a.keyCode&&E.metaKeyPressed(a)&&(a.preventDefault(),j()),27===a.keyCode&&(a.preventDefault(),d())}).on("heartbeat-send.fee-refresh-lock",function(a,b){b["wp-refresh-post-lock"]={post_id:wp.fee.post.ID(),lock:wp.fee.lock}}).on("heartbeat-tick.fee-refresh-lock",function(b,c){var d,e,f=c["wp-refresh-post-lock"];f&&(f.lock_error?(d=a("#post-lock-dialog"),d.length&&!d.is(":visible")&&(wp.autosave&&(I.one("heartbeat-tick",function(){wp.autosave.server.suspend(),d.removeClass("saving").addClass("saved"),H.off("beforeunload.edit-post")}),d.addClass("saving"),wp.autosave.server.triggerSave()),f.lock_error.avatar_src&&(e=a('<img class="avatar avatar-64 photo" width="64" height="64" />').attr("src",f.lock_error.avatar_src.replace(/&amp;/g,"&")),d.find("div.post-locked-avatar").empty().append(e)),d.show().find(".currently-editing").text(f.lock_error.text),d.find(".wp-tab-first").focus())):f.new_lock&&(wp.fee.lock=f.new_lock))}).on("heartbeat-send.fee-refresh-nonces",function(a,b){A&&(b["wp-refresh-post-nonces"]={post_id:wp.fee.post.ID(),post_nonce:wp.fee.nonces.post})}).on("heartbeat-tick.fee-refresh-nonces",function(a,c){var d=c["wp-refresh-post-nonces"];d&&(b(),d.heartbeatNonce&&(window.heartbeatSettings.nonce=d.heartbeatNonce))}).on("after-autosave",function(){s&&s.fadeOut("slow",function(){s.remove()})}),V.on("click.fee",function(b){G||(b.preventDefault(),a(".fee-category-modal").modal("show"))}),a(".fee-category-modal").on("hide.bs.modal",function(){wp.ajax.post("fee_categories",{nonce:wp.fee.nonces.categories,post_ID:wp.fee.post.ID(),separator:V.data("separator"),parents:V.data("parents"),post_category:wp.fee.post.post_category()}).done(function(a){V.html(a)})}),K.find('a[rel="tag"]').on("click.fee",function(a){a.preventDefault()}),K.find("time").add(K.find(".entry-date")).on("click.fee",function(a){a.preventDefault()}),K.find('a[rel="author"]').on("click.fee",function(a){a.preventDefault()}),a("a").not('a[href^="#"]').on("click.fee",function(b){var c=a(this);l()&&!E.metaKeyPressed(b)&&(b.preventDefault(),n(function(){e(c.attr("href"))}))}),a("#wp-admin-bar-edit-publish > a").on("click.fee",function(){event.preventDefault(),k()}),a("#wp-admin-bar-edit-save > a").on("click.fee",function(){event.preventDefault(),j()}),a("#wp-admin-bar-edit > a").on("click.fee",function(){event.preventDefault(),c()}),L.on("click.fee",function(a){a.preventDefault(),f()}),-1!==a.inArray(wp.fee.post.post_status(),["publish","future","private"])&&(a("#wp-admin-bar-edit-publish").hide(),a("#wp-admin-bar-edit-save > a").text("Update")),wp.fee.notices.autosave&&(s=o(wp.fee.notices.autosave,"error")),_.extend(wp.media.featuredImage,{set:function(a){var b=wp.media.view.settings;b.post.featuredImageId=a,wp.media.post("fee_thumbnail",{post_ID:b.post.id,thumbnail_ID:b.post.featuredImageId,_wpnonce:b.post.nonce,size:N.data("size")}).done(function(a){O.html(a),N.removeClass("fee-thumbnail-active"),""===a?N.addClass("fee-empty"):N.removeClass("fee-empty")})}}),P.on("click.fee-edit-thumbnail",function(){wp.media.featuredImage.frame().open()}),Q.on("click.fee-remove-thumbnail",function(){wp.media.featuredImage.set(-1)}),N.on("click.fee-thumbnail-active",function(){G||N.hasClass("fee-empty")||(N.addClass("fee-thumbnail-active"),I.on("click.fee-thumbnail-active",function(a){N.get(0)===a.target||N.has(a.target).length||(N.removeClass("fee-thumbnail-active"),I.off("click.fee-thumbnail-active"))}))}),a(".categorydiv").each(function(){var b,c,d,e,f,g=a(this).attr("id");d=g.split("-"),d.shift(),e=d.join("-"),f=e+"_tab","category"===e&&(f="cats"),a("a","#"+e+"-tabs").click(function(){var b=a(this).attr("href");return a(this).parent().addClass("tabs").siblings("li").removeClass("tabs"),a("#"+e+"-tabs").siblings(".tabs-panel").hide(),a(b).show(),"#"+e+"-all"===b?window.deleteUserSetting(f):window.setUserSetting(f,"pop"),!1}),window.getUserSetting(f)&&a('a[href="#'+e+'-pop"]',"#"+e+"-tabs").click(),a("#new"+e).one("focus",function(){a(this).val("").removeClass("form-input-tip")}),a("#new"+e).keypress(function(b){13===b.keyCode&&(b.preventDefault(),a("#"+e+"-add-submit").click())}),a("#"+e+"-add-submit").click(function(){a("#new"+e).focus()}),b=function(b){return a("#new"+e).val()?(b.data+="&"+a(":checked","#"+e+"checklist").serialize(),a("#"+e+"-add-submit").prop("disabled",!0),b):!1},c=function(b,c){var d,f=a("#new"+e+"_parent");a("#"+e+"-add-submit").prop("disabled",!1),"undefined"!==c.parsed.responses[0]&&(d=c.parsed.responses[0].supplemental.newcat_parent)&&(f.before(d),f.remove())},a("#"+e+"checklist").wpList({alt:"",response:e+"-ajax-response",addBefore:b,addAfter:c}),a("#"+e+"-add-toggle").click(function(){return a("#"+e+"-adder").toggleClass("wp-hidden-children"),a('a[href="#'+e+'-all"]',"#"+e+"-tabs").click(),a("#new"+e).focus(),!1}),a("#"+e+"checklist, #"+e+"checklist-pop").on("click",'li.popular-category > label input[type="checkbox"]',function(){var b=a(this),c=b.is(":checked"),d=b.val();d&&b.parents("#taxonomy-"+e).length&&a("#in-"+e+"-"+d+", #in-popular-"+e+"-"+d).prop("checked",c)})}),_.extend(wp.fee,{on:c,off:d,toggle:f,isOn:g,isOff:h,isDirty:l,save:j,publish:k,addNotice:o,getPost:i})})}(jQuery);